import{a as M,r as t,j as k}from"./index-df1SZI71.js";import{a as H}from"./api-x0wxRGLh.js";const g=t.createContext(null);function p({children:o}){const{token:u}=M(),[m,b]=t.useState(!0),[f,S]=t.useState(""),[s,Y]=t.useState(null),[r,y]=t.useState(""),[a,h]=t.useState(""),[l,x]=t.useState(""),C=async()=>{try{b(!0),S("");const e=await H(u);Y(e);const A=Object.keys((e==null?void 0:e.hierarchy)||{}),i=e!=null&&e.currentAcademicYear&&A.includes(e.currentAcademicYear)?e.currentAcademicYear:A[0]||"",j=Object.keys(((e==null?void 0:e.hierarchy)||{})[i]||{})[0]||"",d=((((e==null?void 0:e.hierarchy)||{})[i]||{})[j]||[])[0]||null;y(i),h(j),x((d==null?void 0:d.id)||"")}catch(e){S(e.message||"Failed to load hierarchy context."),Y(null)}finally{b(!1)}};t.useEffect(()=>{C()},[u]);const v=t.useMemo(()=>Object.keys((s==null?void 0:s.hierarchy)||{}),[s]),E=t.useMemo(()=>Object.keys(((s==null?void 0:s.hierarchy)||{})[r]||{}),[s,r]),n=t.useMemo(()=>(((s==null?void 0:s.hierarchy)||{})[r]||{})[a]||[],[s,r,a]),c=t.useMemo(()=>n.find(e=>e.id===l)||n[0]||null,[n,l]),G=t.useMemo(()=>{var e;return[((e=s==null?void 0:s.institution)==null?void 0:e.name)||"Institution",r||"Year",a||"Grade",(c==null?void 0:c.name)||"Class"]},[s,r,a,c]),I=t.useMemo(()=>({loading:m,error:f,hierarchy:s,availableYears:v,availableGrades:E,availableClasses:n,selectedYear:r,selectedGrade:a,selectedClassId:l,selectedClass:c,setSelectedYear:y,setSelectedGrade:h,setSelectedClassId:x,breadcrumbs:G,reloadHierarchy:C}),[m,f,s,v,E,n,r,a,l,c,G]);return k.jsx(g.Provider,{value:I,children:o})}function P(){const o=t.useContext(g);return o||{loading:!1,error:"",hierarchy:null,availableYears:[],availableGrades:[],availableClasses:[],selectedYear:"",selectedGrade:"",selectedClassId:"",selectedClass:null,setSelectedYear:()=>{},setSelectedGrade:()=>{},setSelectedClassId:()=>{},breadcrumbs:["Institution","Year","Grade","Class"],reloadHierarchy:async()=>{}}}export{p as A,P as u};
