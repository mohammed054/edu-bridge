import{u as E,a as A,r,j as e}from"./index-df1SZI71.js";import{f as F,a as O}from"./api-x0wxRGLh.js";const D=[{key:"risk",title:"High-Risk Students",to:"/admin/students"},{key:"tickets",title:"Pending Tickets",to:"/admin/feedback"},{key:"conflicts",title:"Schedule Conflicts",to:"/admin/schedule"},{key:"survey",title:"Survey Participation",to:"/admin/surveys"},{key:"unread",title:"Unread Notifications",to:"/admin/notifications"},{key:"responses",title:"Survey Responses",to:"/admin/reports"}];function H(){var b,y,f;const m=E(),{token:l}=A(),[p,u]=r.useState(!0),[h,N]=r.useState(""),[t,g]=r.useState(null),[n,j]=r.useState(null),[c,k]=r.useState(""),[i,v]=r.useState(""),o=async()=>{try{u(!0),N("");const[s,a]=await Promise.all([F(l,{grade:c,className:i}),O(l)]);g(s),j(a)}catch(s){N(s.message||"Failed to load enterprise dashboard."),g(null),j(null)}finally{u(!1)}};r.useEffect(()=>{o()},[l,c,i]),r.useEffect(()=>{const s=window.setInterval(()=>{o()},6e4);return()=>window.clearInterval(s)},[l,c,i]);const S=r.useMemo(()=>{const s=(n==null?void 0:n.hierarchy)||{},a=[];return Object.keys(s).forEach(d=>{Object.keys(s[d]||{}).forEach(x=>a.push(x))}),[...new Set(a)].filter(Boolean).sort()},[n]),R=r.useMemo(()=>{const s=(n==null?void 0:n.hierarchy)||{},a=[];return Object.keys(s).forEach(d=>{Object.keys(s[d]||{}).forEach(x=>{(s[d][x]||[]).forEach(C=>a.push(C.name))})}),[...new Set(a)].filter(Boolean).sort()},[n]),w=r.useMemo(()=>{var s;return t?{risk:(t.highRiskStudents||[]).length,tickets:Number(t.pendingFeedbackTickets||0),conflicts:(t.scheduleConflicts||[]).length,survey:Number(t.surveyParticipationRate||0).toFixed(2),unread:Number(((s=t.notificationQueue)==null?void 0:s.unread)||0),responses:Number(t.surveyResponseCount||0)}:{risk:0,tickets:0,conflicts:0,survey:0,unread:0,responses:0}},[t]);return e.jsxs("div",{className:"page-enter space-y-5 p-1",children:[e.jsx("header",{className:"panel-card",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-text-primary",children:"Enterprise Admin Dashboard"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:"Operational cockpit with live risks, workload, capacity, ticket backlog, conflicts, and participation."})]}),e.jsxs("p",{className:"text-xs text-text-secondary",children:["Last update: ",t!=null&&t.generatedAt?new Date(t.generatedAt).toLocaleString("en-US"):"-"]})]})}),h?e.jsx("p",{className:"rounded-sm border border-danger/25 bg-danger/5 px-3 py-2 text-sm text-danger",children:h}):null,e.jsx("section",{className:"panel-card",children:e.jsxs("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs("select",{value:c,onChange:s=>k(s.target.value),className:"focus-ring rounded-sm border border-border bg-white px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"All grades"}),S.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:i,onChange:s=>v(s.target.value),className:"focus-ring rounded-sm border border-border bg-white px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"All classes"}),R.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx("button",{type:"button",className:"action-btn",onClick:o,disabled:p,children:"Refresh Dashboard"}),e.jsx("button",{type:"button",className:"action-btn",onClick:()=>m("/admin/reports"),children:"Open Reports Engine"})]})}),e.jsx("section",{className:"grid gap-3 sm:grid-cols-2 xl:grid-cols-3",children:D.map(s=>e.jsxs("button",{type:"button",className:"panel-card-hover text-left",onClick:()=>m(s.to),children:[e.jsx("p",{className:"text-xs text-text-secondary",children:s.title}),e.jsx("p",{className:"mt-2 text-3xl font-bold text-text-primary",children:w[s.key]})]},s.key))}),p?e.jsx("section",{className:"panel-card",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"skeleton h-16"}),e.jsx("div",{className:"skeleton h-16"}),e.jsx("div",{className:"skeleton h-16"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"grid gap-4 xl:grid-cols-2",children:[e.jsxs("article",{className:"panel-card",children:[e.jsx("h2",{className:"mb-3 text-base font-semibold text-text-primary",children:"Attendance Rate Trends"}),e.jsxs("div",{className:"space-y-2",children:[((t==null?void 0:t.attendanceRateTrends)||[]).slice(0,10).map((s,a)=>e.jsxs("div",{className:"rounded-sm border border-border bg-background p-2 text-xs",children:[e.jsxs("p",{className:"font-semibold text-text-primary",children:[s.studentName||"Student"," | ",s.className||"-"]}),e.jsxs("p",{className:"text-text-secondary",children:["risk: ",s.riskStatus||"-"," | attendance: ",s.attendanceRate??"-"]})]},`${s.studentId||a}-${s.className||""}`)),(b=t==null?void 0:t.attendanceRateTrends)!=null&&b.length?null:e.jsx("p",{className:"text-xs text-text-secondary",children:"No trend snapshots."})]})]}),e.jsxs("article",{className:"panel-card",children:[e.jsx("h2",{className:"mb-3 text-base font-semibold text-text-primary",children:"Teacher Workload Heatmap"}),e.jsx("div",{className:"space-y-2",children:((t==null?void 0:t.teacherWorkloadHeatmap)||[]).slice(0,12).map(s=>e.jsxs("div",{className:"rounded-sm border border-border bg-background p-2 text-xs",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-text-primary",children:s.teacherName}),e.jsxs("span",{className:"text-text-secondary",children:[Number(s.sessions||0)," sessions"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-border",children:e.jsx("div",{className:"h-2 rounded-full bg-primary",style:{width:`${Math.min(100,Number(s.sessions||0)*5)}%`}})})]},s.teacherName))})]})]}),e.jsxs("section",{className:"grid gap-4 xl:grid-cols-2",children:[e.jsxs("article",{className:"panel-card",children:[e.jsx("h2",{className:"mb-3 text-base font-semibold text-text-primary",children:"Class Capacity Utilization"}),e.jsx("div",{className:"space-y-2",children:((t==null?void 0:t.classCapacityUtilization)||[]).slice(0,15).map(s=>e.jsxs("div",{className:"rounded-sm border border-border bg-background p-2 text-xs",children:[e.jsx("p",{className:"font-semibold text-text-primary",children:s.className}),e.jsxs("p",{className:"text-text-secondary",children:["enrolled: ",s.enrolled," / ",s.capacity," | utilization: ",Number(s.utilizationRate||0).toFixed(2),"%"]})]},s.className))})]}),e.jsxs("article",{className:"panel-card",children:[e.jsx("h2",{className:"mb-3 text-base font-semibold text-text-primary",children:"High-Risk Student Alerts"}),e.jsxs("div",{className:"space-y-2",children:[((t==null?void 0:t.highRiskStudents)||[]).slice(0,15).map((s,a)=>e.jsxs("div",{className:"rounded-sm border border-danger/35 bg-danger/5 p-2 text-xs",children:[e.jsxs("p",{className:"font-semibold text-text-primary",children:[s.studentName||"Student"," | ",s.className||"-"]}),e.jsxs("p",{className:"text-danger",children:["risk score: ",s.riskScore??"-"," | status: ",s.riskStatus||"-"]})]},`${s.studentId||a}-${s.className||""}`)),(y=t==null?void 0:t.highRiskStudents)!=null&&y.length?null:e.jsx("p",{className:"text-xs text-text-secondary",children:"No high-risk alerts for current filter."})]})]})]}),e.jsxs("section",{className:"panel-card",children:[e.jsx("h2",{className:"mb-3 text-base font-semibold text-text-primary",children:"Schedule Conflict Alerts"}),e.jsxs("div",{className:"space-y-2",children:[((t==null?void 0:t.scheduleConflicts)||[]).slice(0,20).map(s=>e.jsxs("div",{className:"rounded-sm border border-danger/35 bg-danger/5 p-2 text-xs",children:[e.jsxs("p",{className:"font-semibold text-text-primary",children:[s.className," | ",s.teacherName]}),e.jsxs("p",{className:"text-text-secondary",children:["Day ",s.dayOfWeek," | ",s.startTime," - ",s.endTime," | Room ",s.room||"-"]}),e.jsxs("p",{className:"text-danger",children:["flags: ",(s.conflictFlags||[]).join(", ")]})]},s.id)),(f=t==null?void 0:t.scheduleConflicts)!=null&&f.length?null:e.jsx("p",{className:"text-xs text-text-secondary",children:"No schedule conflicts detected."})]})]})]})]})}export{H as default};
