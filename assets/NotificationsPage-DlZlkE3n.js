import{a as A,r as a,j as t}from"./index-df1SZI71.js";import{J as q,K as R}from"./api-x0wxRGLh.js";import{P as $}from"./PageHeading-CUjM0fdU.js";const j=["open","pending","resolved","escalated"],C=["feedback","broadcast","schedule","incident","system","ticket","risk","capacity","survey"],E=["admin","teacher","student","parent"],T={open:"border-warning/30 bg-warning/10 text-warning",pending:"border-primary/30 bg-primary/10 text-primary",resolved:"border-success/30 bg-success/10 text-success",escalated:"border-danger/30 bg-danger/10 text-danger"};function _(){const{token:c}=A(),[r,m]=a.useState([]),[v,b]=a.useState(!0),[o,h]=a.useState(""),[f,i]=a.useState(""),[y,N]=a.useState(""),[u,S]=a.useState(""),[x,w]=a.useState(""),k=async()=>{try{b(!0),i("");const e=await q(c,{workflowStatus:u,category:x,limit:500});m(e.rows||[])}catch(e){i(e.message||"Failed to load notification workflow."),m([])}finally{b(!1)}};a.useEffect(()=>{k()},[c,u,x]);const l=a.useMemo(()=>{const e=r.filter(n=>n.workflowStatus==="open").length,s=r.filter(n=>n.workflowStatus==="pending").length,p=r.filter(n=>n.workflowStatus==="escalated").length,g=r.filter(n=>n.requiresAcknowledgement===!0).length;return{open:e,pending:s,escalated:p,ackRequired:g}},[r]),d=async(e,s,p)=>{try{h(e),i(""),N(""),await R(c,e,s),N(p||"Notification updated."),await k()}catch(g){i(g.message||"Failed to update notification workflow.")}finally{h("")}};return t.jsxs("div",{className:"page-enter space-y-5 p-1",children:[t.jsx($,{title:"Notification Workflow",subtitle:"Actionable notification queue with assignment, escalation, and acknowledgment controls."}),f?t.jsx("p",{className:"rounded-sm border border-danger/25 bg-danger/5 px-3 py-2 text-sm text-danger",children:f}):null,y?t.jsx("p",{className:"rounded-sm border border-success/25 bg-success/10 px-3 py-2 text-sm text-success",children:y}):null,t.jsx("section",{className:"panel-card",children:t.jsxs("div",{className:"grid gap-3 md:grid-cols-4",children:[t.jsxs("select",{value:u,onChange:e=>S(e.target.value),className:"focus-ring rounded-sm border border-border bg-white px-3 py-2 text-sm",children:[t.jsx("option",{value:"",children:"All workflow states"}),j.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs("select",{value:x,onChange:e=>w(e.target.value),className:"focus-ring rounded-sm border border-border bg-white px-3 py-2 text-sm",children:[t.jsx("option",{value:"",children:"All categories"}),C.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs("p",{className:"rounded-sm border border-border bg-background px-3 py-2 text-sm text-text-secondary",children:["Open: ",l.open," | Pending: ",l.pending]}),t.jsxs("p",{className:"rounded-sm border border-border bg-background px-3 py-2 text-sm text-text-secondary",children:["Escalated: ",l.escalated," | Ack Required: ",l.ackRequired]})]})}),t.jsx("section",{className:"panel-card",children:v?t.jsxs("div",{className:"grid gap-2",children:[t.jsx("div",{className:"skeleton h-12"}),t.jsx("div",{className:"skeleton h-12"}),t.jsx("div",{className:"skeleton h-12"})]}):t.jsxs("div",{className:"space-y-3",children:[r.length?null:t.jsx("p",{className:"text-sm text-text-secondary",children:"No notifications in current filter."}),r.map(e=>t.jsx("article",{className:"rounded-sm border border-border bg-background p-3",children:t.jsxs("div",{className:"grid gap-2 lg:grid-cols-[1.2fr_auto_auto_auto_auto]",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("h2",{className:"text-sm font-semibold text-text-primary",children:e.title||"Notification"}),t.jsx("span",{className:`rounded-full border px-2 py-1 text-[11px] font-semibold ${T[e.workflowStatus]||"border-border bg-background text-text-secondary"}`,children:e.workflowStatus}),t.jsx("span",{className:"rounded-full border border-border px-2 py-1 text-[11px] text-text-secondary",children:e.category||"system"})]}),t.jsxs("p",{className:"mt-1 text-xs text-text-secondary",children:["recipient role: ",e.recipientRole||"-"," | urgency: ",e.urgency||"-"," | priority: ",Number(e.priorityWeight||1)]}),t.jsxs("p",{className:"mt-1 text-xs text-text-secondary",children:["assignedTo: ",e.assignedToId||"-"," | escalation level: ",Number(e.escalationLevel||0)," | due: ",e.dueAt?new Date(e.dueAt).toLocaleString("en-US"):"-"]})]}),t.jsx("select",{value:e.workflowStatus||"open",onChange:s=>d(e.id,{workflowStatus:s.target.value},`Status moved to ${s.target.value}.`),className:"focus-ring rounded-sm border border-border bg-white px-2 py-2 text-xs",disabled:o===e.id,children:j.map(s=>t.jsx("option",{value:s,children:s},`${e.id}-status-${s}`))}),t.jsx("select",{value:String(e.priorityWeight||1),onChange:s=>d(e.id,{priorityWeight:Number(s.target.value)},`Priority updated to ${s.target.value}.`),className:"focus-ring rounded-sm border border-border bg-white px-2 py-2 text-xs",disabled:o===e.id,children:[1,2,3,4,5].map(s=>t.jsxs("option",{value:s,children:["P",s]},`${e.id}-priority-${s}`))}),t.jsxs("select",{value:e.assignedToRole||"",onChange:s=>d(e.id,{assignedToRole:s.target.value||null},`Assigned role updated to ${s.target.value||"none"}.`),className:"focus-ring rounded-sm border border-border bg-white px-2 py-2 text-xs",disabled:o===e.id,children:[t.jsx("option",{value:"",children:"Unassigned"}),E.map(s=>t.jsx("option",{value:s,children:s},`${e.id}-role-${s}`))]}),t.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.jsx("button",{type:"button",className:"action-btn px-2 py-1 text-[11px]",disabled:o===e.id,onClick:()=>d(e.id,{acknowledge:!0},"Notification acknowledged."),children:"Acknowledge"}),t.jsx("button",{type:"button",className:"action-btn px-2 py-1 text-[11px]",disabled:o===e.id,onClick:()=>d(e.id,{escalate:!0},"Notification escalated."),children:"Escalate"}),t.jsx("button",{type:"button",className:"action-btn px-2 py-1 text-[11px]",disabled:o===e.id,onClick:()=>d(e.id,{requiresAcknowledgement:e.requiresAcknowledgement!==!0},`Acknowledgement requirement ${e.requiresAcknowledgement?"removed":"enabled"}.`),children:e.requiresAcknowledgement?"Unset Ack Req":"Set Ack Req"})]})]})},e.id))]})})]})}export{_ as default};
